@startuml
title UC_ConsulterStockCentral – GET /stock/central

actor "Responsable logistique" as User
participant "KrakenD Gateway\n:8080" as Gateway
participant "StockController" as Controller
participant "JwtAuthGuard" as Guard
participant "StockService" as Service
participant "PrismaService" as Prisma

== Requête ==
User -> Gateway: GET /stock/central\nAuthorization: Bearer <JWT>
Gateway -> Controller: /stock/central (headers)

== Auth ==
Controller -> Guard: canActivate(req)
Guard -> Guard: vérifier/decoder JWT
alt Token invalide/expiré
  Guard --> Controller: throw 401
  Controller --> Gateway: 401
  Gateway --> User: 401 Unauthorized
  return
else OK
  Guard --> Controller: allow
end

== Traitement ==
Controller -> Service: consulterStockCentral()
Service -> Prisma: stockCentral.findMany({ include: { produit: true } })
Prisma --> Service: stocks[]

Service -> Service: map -> [{produitId, nom, quantite, seuilCritique}]
Service --> Controller: liste stock central (JSON)
Controller --> Gateway: 200 OK + body
Gateway --> User: 200 OK + body
@enduml
